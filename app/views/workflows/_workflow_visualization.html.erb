<!-- Ïª®Ìä∏Î°§Îü¨ Ìå®ÏπòÏóêÏÑú ÏÑ§Ï†ïÌïú ÎîîÎ≤ÑÍ∑∏ HTML ÌëúÏãú -->
<%= @workflow_viz_debug.html_safe if @workflow_viz_debug %>

<!-- Í∏∞Ï°¥ ÏãúÍ∞ÅÌôî Î°úÏßÅ -->
<% if @workflow_viz_role && @workflow_viz_tracker %>
  <div class="workflow-visualization" style="margin-top: 20px; padding: 15px; border: 2px solid #6f42c1; border-radius: 4px; background-color: #f3e5ff;">
    <h3>üéØ Workflow Visualization (View Partial)</h3>
    
    <% 
      helper = Object.new
      helper.extend(WorkflowVizHelper)
      visualization_html = helper.generate_workflow_mermaid_graph(@workflow_viz_role, @workflow_viz_tracker)
    %>
    
    <% if visualization_html.present? %>
      <%= visualization_html.html_safe %>
    <% else %>
      <p class="info">No workflow transitions defined for role "<%= @workflow_viz_role.name %>" and tracker "<%= @workflow_viz_tracker.name %>".</p>
    <% end %>
  </div>
<% elsif params[:role_id].present? || params[:tracker_id].present? %>
  <div class="workflow-visualization" style="margin-top: 20px; padding: 15px; border: 2px solid #fd7e14; border-radius: 4px; background-color: #fff3cd;">
    <h3>‚ö†Ô∏è Workflow Visualization (Debug - View Partial)</h3>
    <p>View partial is working!</p>
    <p>Params: role_id=<%= params[:role_id].inspect %>, tracker_id=<%= params[:tracker_id].inspect %></p>
    <p>Instance vars: @workflow_viz_role=<%= @workflow_viz_role.inspect %>, @workflow_viz_tracker=<%= @workflow_viz_tracker.inspect %></p>
    <p>Time: <%= Time.current %></p>
  </div>
<% else %>
  <div class="workflow-visualization" style="margin-top: 20px; padding: 15px; border: 2px solid #6c757d; border-radius: 4px; background-color: #f8f9fa;">
    <h3>‚ÑπÔ∏è Workflow Visualization (View Partial - No Params)</h3>
    <p>View partial loaded but no parameters found.</p>
    <p>Available instance variables:</p>
    <ul>
      <% instance_variables.select { |v| v.to_s.include?('workflow') }.each do |var| %>
        <li><%= var %>: <%= instance_variable_get(var).inspect %></li>
      <% end %>
    </ul>
  </div>
<% end %>
